<!-- @format -->

<script>
  import {setContext} from 'svelte'
  import {readable} from 'svelte/store'
  import Router from 'svelte-spa-router'
  import {Contract} from 'etleneum'

  import {NAME, CONTRACT} from './constants'
  import Index from './Index.html'
  import Account from './Account.html'
  import Banner from './Banner.html'

  setContext('contract', Contract(CONTRACT))
  setContext(
    'kbaccounts',
    readable({}, set => {
      Contract('cog4wt7q8n3')
        .state(
          `.identities | to_entries | map(select(.key != "_")) | map({key: .value, value: .key}) | from_entries`
        )
        .then(set)
      return () => {}
    })
  )

  const routes = {
    '/': Index,
    '/account': Account,
    '/:banner_id': Banner
  }
</script>

<style>
  h1 {
    color: var(--emphasis-rare);
  }
  main {
    margin: 43px auto;
  }
  h1 a {
    text-decoration: none;
    color: inherit;
  }
  footer {
    width: 100%;
    margin-top: 180px;
    padding-top: 18px;
    font-size: 0.9rem;
  }
  footer a {
    color: var(--emphasis-rare);
  }
</style>

<main>
  <div>
    <h1><a href="#/">{NAME}</a></h1>
    <Router {routes} />
  </div>
</main>
<footer>
  <b>{NAME}</b> is an
  <a href="https://etleneum.com/#/contract/{CONTRACT}" target="_blank"
    >Etleneum</a
  >
  contract. All its core functionalities are defined there within visible and
  immutable code you should read before calling methods here.
</footer>
